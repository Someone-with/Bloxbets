<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Donate → Get Points</title>
  <style>
    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      max-width:560px;
      margin:2rem auto;
      padding:1rem;
      background:#f8f9fc;
      color:#1a1a1a;
    }
    h1{color:#5865F2;margin-bottom:.5rem;}
    p{margin:.5rem 0 1.5rem;}
    label{display:block;margin:1rem 0 .4rem;font-weight:600;}
    input{
      padding:.8rem;
      font-size:1rem;
      width:100%;
      border:1px solid #ccc;
      border-radius:6px;
      box-sizing:border-box;
    }
    #paypal-button-container{
      margin-top:1.5rem;
      opacity:0.5;
      pointer-events:none;
      transition:opacity .3s;
    }
    #paypal-button-container.enabled{
      opacity:1;
      pointer-events:auto;
    }
    .success{
      background:#d4edda;
      color:#155724;
      padding:1rem;
      border-radius:6px;
      margin-top:1.5rem;
      display:none;
      font-weight:500;
    }
    .required-hint{
      font-size:0.9rem;
      color:#d32f2f;
      margin-top:0.5rem;
      display:none;
    }
  </style>
</head>
<body>

  <h1>Support the Game!</h1>
  <p>Every $1 = 1 point in-game. Your Discord ID will be announced.</p>

  <label>Discord User ID <span style="color:#d32f2f;">*</span>:</label>
  <input id="discordId" type="text" placeholder="123456789012345678" required>
  <div class="required-hint" id="idHint">Please enter your Discord User ID to continue.</div>

  <label>Donation Amount (USD):</label>
  <input id="amount" type="number" min="1" step="0.01" placeholder="5.00" value="5.00">

  <div id="paypal-button-container">
    <p style="text-align:center;color:#666;font-style:italic;">Enter your Discord ID above to enable payment</p>
  </div>

  <div id="success" class="success">
    Donation successful! Points added in Discord.
  </div>

  <!-- PayPal SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=AUp0UM3hJPic-OtC2uaIKjs0EJLxxn0zVNZVrHs1C-GVK-5BaI0gHj10iNbgpS4fnwPuGUcqGUCGcrPy&currency=USD"></script>

  <script>
    // === YOUR DISCORD WEBHOOK ===
    const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1434584171207987351/LwPIu4d10o0rwE8DUfGps4XsVXRdyMHDOf8hi-lGWt9LgjgX1t9YblPnmAjCEOiCLVz5";

    const discordIdInput = document.getElementById('discordId');
    const amountInput    = document.getElementById('amount');
    const paypalContainer = document.getElementById('paypal-button-container');
    const successDiv     = document.getElementById('success');
    const idHint         = document.getElementById('idHint');

    // Validate Discord ID (must be 17–19 digits)
    function validateDiscordId(id) {
      return /^\d{17,19}$/.test(id.trim());
    }

    // Enable/disable PayPal button
    function updatePayPalButton() {
      const id = discordIdInput.value.trim();
      if (validateDiscordId(id)) {
        paypalContainer.classList.add('enabled');
        idHint.style.display = 'none';
      } else {
        paypalContainer.classList.remove('enabled');
        idHint.style.display = 'block';
      }
    }

    // Listen for input
    discordIdInput.addEventListener('input', updatePayPalButton);

    // Initial check
    updatePayPalButton();

    // Render PayPal Button
    paypal.Buttons({
      createOrder: function(data, actions) {
        const id = discordIdInput.value.trim();
        if (!validateDiscordId(id)) {
          alert('Please enter a valid Discord User ID (17–19 digits).');
          return;
        }
        let raw = amountInput.value.trim();
        if (!raw || isNaN(raw) || parseFloat(raw) < 1) {
          alert('Please enter an amount of $1.00 or more.');
          return;
        }
        const value = parseFloat(raw).toFixed(2);
        return actions.order.create({
          purchase_units: [{ amount: { value } }]
        });
      },

      onApprove: function(data, actions) {
        return actions.order.capture().then(async function(details) {
          const amount = details.purchase_units[0].amount.value;
          const discordId = discordIdInput.value.trim();
          const mention = `<@${discordId}>`;

          const message = {
            content: `Game deposit!\nUser ${mention}\nPayment PayPal\nPoints (${amount})`
          };

          try {
            const resp = await fetch(DISCORD_WEBHOOK, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(message)
            });
            if (resp.ok) {
              successDiv.style.display = 'block';
            } else {
              throw new Error('Status: ' + resp.status);
            }
          } catch (err) {
            console.error('Discord error:', err);
            alert('Payment succeeded, but Discord alert failed. Contact admin.');
          }
        });
      },

      onError: function(err) {
        console.error('PayPal error:', err);
        alert('Payment failed – please try again.');
      }
    }).render('#paypal-button-container');
  </script>

</body>
</html>
